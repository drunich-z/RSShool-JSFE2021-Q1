(()=>{"use strict";var e,t,n,a,i,s={653:(e,t,n)=>{n.d(t,{Z:()=>a});const a={renderCarImage:e=>`\n    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" \n      xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n      viewBox="0 0 17.485 17.485" style="enable-background:new 0 0 17.485 17.485;" xml:space="preserve">\n    <g>\n      <g>\n        <path style="fill:${e};" d="M17.477,8.149c-0.079-0.739-3.976-0.581-3.976-0.581L11.853,5.23H4.275L3.168,7.567H0v2.404\n          l2.029,0.682c0.123-0.836,0.843-1.48,1.711-1.48c0.939,0,1.704,0.751,1.73,1.685l6.62,0.041c0.004-0.951,0.779-1.726,1.733-1.726\n          c0.854,0,1.563,0.623,1.704,1.439l1.479-0.17C17.006,10.442,17.556,8.887,17.477,8.149z M4.007,7.568l0.746-1.771h2.864\n          l0.471,1.771H4.007z M8.484,7.568L8.01,5.797h3.67l1.137,1.771H8.484z"/>\n        <circle style="fill:#030104;" cx="3.759" cy="10.966" r="1.289"/>\n        <circle style="fill:#030104;" cx="13.827" cy="10.9" r="1.29"/>\n      </g>\n    </g>\n    </svg>\n    `,renderCar(e){return`\n    <div class="general-buttons">\n      <button class="button select-button" id="select-car-${e.id}">Select</button>\n      <button class="button remove-button" id="remove-car-${e.id}">Remove</button>\n      <span class="car-name">${e.name}</span>\n    </div>\n    <div class="road">\n      <div class="launchpad">\n        <div class="control-panel">\n          <button class="icon start-engine-button" id="start-engine-car-${e.id}">Start</button>\n          <button class="icon stop-engine-button" id="stop-engine-car-${e.id}">Stop</button>\n        </div>\n        <div class="car" id="car-${e.id}">\n          ${this.renderCarImage(e.color)}\n        </div>\n      </div>\n      <div class="flag" id="flag-${e.id}">üèÅ</div>\n    </div>\n    `}}},517:(e,t,n)=>{n.a(e,(async e=>{n.d(t,{Z:()=>u});var a=n(549),i=n(300),s=n(1),r=n(811),o=n(116),d=n(946),c=n(552),l=e([o,i,s,c,a,r,d]);[o,i,s,c,a,r,d]=l.then?await l:l;const u={async garageRoute(){s.Z.switchView("garage"),a.Z.view="garage",s.Z.updateNextPrevButtonsState("garage")},async winnersRoute(){s.Z.winnersHTMLSection&&(s.Z.winnersHTMLSection.innerHTML=r.Z.renderWinners()),s.Z.switchView("winners"),a.Z.view="winners",s.Z.updateNextPrevButtonsState("winners")},async initControlls(){s.Z.init(),o.Z.init(),c.Z.init(),s.Z.garageHTMLSection.innerHTML=i.Z.renderGarage(),document.body.addEventListener("click",(e=>async function(e){const t=e.target;t&&(t.classList.contains("next-button")&&s.Z.buttonNextPrevHandle("next"),t.classList.contains("prev-button")&&s.Z.buttonNextPrevHandle("prev"),t.classList.contains("table-wins")&&s.Z.reSortWinnersTable("wins"),t.classList.contains("table-time")&&s.Z.reSortWinnersTable("time"),t.classList.contains("start-engine-button")&&d.Z.carStartDrive(t),t.classList.contains("stop-engine-button")&&d.Z.carStopDrive(t),t.classList.contains("select-button")&&d.Z.selectButtonHandle(t),t.classList.contains("remove-button")&&d.Z.removeButtonHandle(t),t.classList.contains("generator-button")&&c.Z.generateExtraCarsHandle(t),t.classList.contains("race-button")&&c.Z.raceHandle(t),t.classList.contains("reset-button")&&c.Z.resetHandle(t))}(e))),o.Z.listenCreateCar(),o.Z.listenUpdateCar()}}}))},946:(e,t,n)=>{n.a(e,(async e=>{n.d(t,{Z:()=>c});var a=n(268),i=n(549),s=n(701),r=n(116),o=n(1),d=e([o,i,r]);[o,i,r]=d.then?await d:d;const c={async carStartDrive(e){if(null===e)return{success:!1,id:0,time:100};const t=e.id.split("start-engine-car-")[1];return await async function(e,t){t.disabled=!0,t.classList.toggle("enabling",!0);const{velocity:n,distance:r}=await a.Z.startEngine(e),o=Math.round(r/n);t.classList.toggle("enabling",!1),document.getElementById(`stop-engine-car-${e}`).disabled=!1;const d=document.getElementById(`car-${e}`),c=document.getElementById(`flag-${e}`);if(null===d)return{success:!1,id:0,time:100};if(null===c)return{success:!1,id:0,time:100};const l=Math.floor(s.Z.getDistanceBetweenElements(d,c)+100);i.Z.animation[e]=s.Z.animation(d,l,o);const{success:u}=await a.Z.drive(e);return u||window.cancelAnimationFrame(i.Z.animation[e].id),{success:u,id:e,time:o}}(Number(t),e)},carStopDrive(e){if(!e)return;const t=e.id.split("stop-engine-car-")[1];!async function(e,t){const n=document.getElementById(`start-engine-car-${e}`);if(!t)return;if(!n)return;t.disabled=!0,t.classList.toggle("enabling",!0),await a.Z.stopEngine(e),t.classList.toggle("enabling",!1),t.disabled=!1;const s=document.getElementById(`car-${e}`);s&&(s.style.transform="translateX(0)"),i.Z.animation[e]&&window.cancelAnimationFrame(i.Z.animation[e].id),n.disabled=!1,n.classList.toggle("enabling",!1)}(Number(t),e)},async selectButtonHandle(e){if(!e)return;const t=Number(e.id.split("select-car-")[1]);i.Z.selectedCar=await a.Z.getCar(t),r.Z.setUpdateControlsEnable(!0),r.Z.inputUpdateName.value=i.Z.selectedCar.name,r.Z.inputUpdateColor.value=i.Z.selectedCar.color},async removeButtonHandle(e){if(!e)return;const t=Number(e.id.split("remove-car-")[1]);await a.Z.deleteCar(t),await a.Z.deleteWinner(t),await i.Z.updateStoreGarage(),await i.Z.updateStoreWinners(),o.Z.updateGarageView()}}}))},116:(e,t,n)=>{n.a(e,(async e=>{n.d(t,{Z:()=>o});var a=n(268),i=n(1),s=n(549),r=e([s,i]);[s,i]=r.then?await r:r;const o={inputUpdateName:document.getElementById("update-name"),inputUpdateColor:document.getElementById("update-color"),submitUpdateButton:document.getElementById("update-submit"),submitUpdate:document.getElementById("update"),inputCreateName:document.getElementById("create-name"),inputCreateColor:document.getElementById("create-color"),submitCreateButton:document.getElementById("create-submit"),submitCreate:document.getElementById("create"),init(){this.inputUpdateName=document.getElementById("update-name"),this.inputUpdateColor=document.getElementById("update-color"),this.submitUpdateButton=document.getElementById("update-submit"),this.submitUpdate=document.getElementById("update"),this.inputCreateName=document.getElementById("create-name"),this.inputCreateColor=document.getElementById("create-color"),this.submitCreateButton=document.getElementById("create-submit"),this.submitCreate=document.getElementById("create")},async listenCreateCar(){this.submitCreate.addEventListener("submit",(async e=>{e.preventDefault();const t={name:this.inputCreateName.value,color:this.inputCreateColor.value};await a.Z.createCar(t),await s.Z.updateStoreGarage(),i.Z.updateGarageView(),this.inputCreateName.value="",this.inputCreateColor.value="#ffffff"}))},async listenUpdateCar(){this.submitUpdate.addEventListener("submit",(async e=>{if(e.preventDefault(),!s.Z.selectedCar.id)return;const t={name:this.inputUpdateName.value,color:this.inputUpdateColor.value};await a.Z.updateCar(s.Z.selectedCar.id,t),await s.Z.updateStoreGarage(),i.Z.updateGarageView(),this.inputUpdateName.value="",this.inputUpdateColor.value="#ffffff",s.Z.selectedCar={name:"",color:"",id:0},this.setUpdateControlsEnable(!1)}))},setUpdateControlsEnable(e){this.inputUpdateName.disabled=!e,this.inputUpdateColor.disabled=!e,this.submitUpdateButton.disabled=!e}}}))},1:(e,t,n)=>{n.a(e,(async e=>{n.d(t,{Z:()=>o});var a=n(300),i=n(811),s=n(549),r=e([s,i,a]);[s,i,a]=r.then?await r:r;const o={garageHTMLSection:document.getElementById("garage"),winnersHTMLSection:document.getElementById("winners-view"),winnersViewHTMLSection:document.getElementById("winners-view"),garageViewHTMLSection:document.getElementById("garage-view"),prev:document.getElementById("prev"),next:document.getElementById("next"),garagePage:document.getElementById("garage-menu"),winnersPage:document.getElementById("winners-menu"),init(){this.garageHTMLSection=document.getElementById("garage"),this.winnersHTMLSection=document.getElementById("winners-view"),this.winnersViewHTMLSection=document.getElementById("winners-view"),this.garageViewHTMLSection=document.getElementById("garage-view"),this.prev=document.getElementById("prev"),this.next=document.getElementById("next"),this.garagePage=document.getElementById("garage-menu"),this.winnersPage=document.getElementById("winners-menu"),this.updateNextPrevButtonsState("garage")},updateNextPrevButtonsState(e){"garage"===e&&(s.Z.carsPage*s.Z.pageGarageLimit<Number(s.Z.carsCount)?this.next.disabled=!1:this.next.disabled=!0,s.Z.carsPage>1?this.prev.disabled=!1:this.prev.disabled=!0),"winners"===e&&(s.Z.winnersPage*s.Z.pageWinnersLimit<Number(s.Z.winnersCount)?this.next.disabled=!1:this.next.disabled=!0,s.Z.winnersPage>1?this.prev.disabled=!1:this.prev.disabled=!0)},switchView(e){"garage"===e&&(this.garageViewHTMLSection.style.display="block",this.winnersViewHTMLSection.style.display="none"),"winners"===e&&(s.Z.updateStoreWinners(),this.updateWinnersView(),this.garageViewHTMLSection.style.display="none",this.winnersViewHTMLSection.style.display="block")},async buttonNextPrevHandle(e){const t="prev"===e?-1:1;"garage"===s.Z.view&&(s.Z.carsPage+=t,await s.Z.updateStoreGarage(),this.updateGarageView(),this.updateNextPrevButtonsState("garage")),"winners"===s.Z.view&&(s.Z.winnersPage+=t,await s.Z.updateStoreWinners(),this.updateWinnersView(),this.updateNextPrevButtonsState("winners"))},updateGarageView(){this.garageHTMLSection.innerHTML=a.Z.renderGarage()},updateWinnersView(){this.winnersHTMLSection.innerHTML=i.Z.renderWinners()},async reSortWinnersTable(e){s.Z.sortOrder="asc"===s.Z.sortOrder?"desc":"asc",s.Z.sortBy=e,await s.Z.updateStoreWinners(),this.updateWinnersView()}}}))},552:(e,t,n)=>{n.a(e,(async e=>{n.d(t,{Z:()=>u});var a=n(268),i=n(549),s=n(701),r=n(946),o=n(1),d=e([r,i,o]);async function c(e,t){const{success:n,id:a,time:s}=await Promise.race(e);if(!n){const n=t.findIndex((e=>e===a));return c([...e.slice(0,n),...e.slice(n+1,e.length)],[...t.slice(0,n),...t.slice(n+1,t.length)])}return Object.assign(Object.assign({},i.Z.cars.find((e=>e.id===a))),{time:+(s/1e3).toFixed(2)})}async function l(e){const t=i.Z.cars.map((({id:t})=>{const n=document.getElementById(`start-engine-car-${t}`);return e(n)}));return await c(t,i.Z.cars.map((e=>e.id)))}[r,i,o]=d.then?await d:d;const u={raceButton:document.getElementById("race"),resetButton:document.getElementById("reset"),generateButton:document.getElementById("generate"),winMessage:document.getElementById("message"),init(){this.raceButton=document.getElementById("race"),this.resetButton=document.getElementById("reset"),this.generateButton=document.getElementById("generate"),this.winMessage=document.getElementById("message")},async generateExtraCarsHandle(e){if(!e)return;e.disabled=!0;const t=s.Z.generateRandomCars();await Promise.all(t.map((async e=>a.Z.createCar(e)))),await i.Z.updateStoreGarage(),o.Z.updateGarageView(),o.Z.updateNextPrevButtonsState("garage"),e.disabled=!1},async raceHandle(e){if(!e)return;e.disabled=!0;const t=await l(r.Z.carStartDrive),n={id:t.id,time:t.time};await a.Z.saveWinner(n),this.winMessage.innerHTML=`${t.name} went first (${t.time}s)!`,this.winMessage.classList.toggle("visible",!0),i.Z.updateStoreWinners(),o.Z.updateWinnersView(),this.raceButton.disabled=!0,this.resetButton.disabled=!1},async resetHandle(e){e&&(e.disabled=!0,i.Z.cars.map((({id:e})=>{const t=document.getElementById(`stop-engine-car-${e}`);return r.Z.carStopDrive(t)})),this.winMessage.classList.toggle("visible",!1),this.raceButton.disabled=!1,this.resetButton.disabled=!0)}}}))},303:(e,t,n)=>{n.a(e,(async e=>{var t=n(755),a=n(911),i=n(517),s=e([i,a]);[i,a]=s.then?await s:s,await t.Z.renderBaseTemplate(),a.Z.init(),i.Z.initControlls(),e()}),1)},268:(e,t,n)=>{n.d(t,{Z:()=>o});const a="http://127.0.0.1:3000",i=`${a}/garage`,s=`${a}/engine`,r=`${a}/winners`,o={getCar:async e=>(await fetch(`${i}/${e}`)).json(),async getCars(e,t=7){const n=await fetch(`${i}?_page=${e}&_limit=${t}`);return{items:await n.json(),count:n.headers.get("X-Total-Count")}},async createCar(e){(await fetch(i,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json()},async deleteCar(e){(await fetch(`${i}/${e}`,{method:"DELETE"})).json()},async updateCar(e,t){(await fetch(`${i}/${e}`,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})).json()},startEngine:async e=>(await fetch(`${s}?id=${e}&status=started`)).json(),stopEngine:async e=>(await fetch(`${s}?id=${e}&status=stopped`)).json(),async drive(e){const t=await fetch(`${s}?id=${e}&status=drive`).catch();return 200!==t.status?{success:!1}:Object.assign({},await t.json())},async getWinners({page:e,limit:t=10,sort:n,order:a}){const i=await fetch(`${r}?_page=${e}&_limit=${t}${((e,t)=>e&&t?`&_sort=${e}&_order=${t}`:"")(n,a)}`),s=await i.json();return{items:await Promise.all(s.map((async e=>Object.assign(Object.assign({},e),{car:await this.getCar(e.id)})))),count:i.headers.get("X-Total-Count")}},getWinner:async e=>(await fetch(`${r}/${e}`)).json(),async deleteWinner(e){(await fetch(`${r}/${e}`,{method:"DELETE"})).json()},async createWinner(e){(await fetch(r,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json()},async updateWinner(e,t){(await fetch(`${r}/${e}`,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})).json()},async saveWinner({id:e,time:t}){if(404===await(async e=>(await fetch(`${r}/${e}`)).status)(e))await this.createWinner({id:e,wins:1,time:t});else{const n=await this.getWinner(e);await this.updateWinner(e,{id:e,wins:(n.wins||0)+1,time:t<(n.time||100)?t:n.time})}}}},300:(e,t,n)=>{n.a(e,(async e=>{n.d(t,{Z:()=>r});var a=n(549),i=n(653),s=e([a]);a=(s.then?await s:s)[0];const r={renderGarage:()=>`\n    <h2>Garage (${a.Z.carsCount})</h2>\n    <h3>Page (${a.Z.carsPage})</h3>\n    <ul class="garage">\n      ${a.Z.cars.map((e=>`<li>${i.Z.renderCar(e)}</li>`)).join("")}\n    </ul>\n  `}}))},811:(e,t,n)=>{n.a(e,(async e=>{n.d(t,{Z:()=>r});var a=n(653),i=n(549),s=e([i]);i=(s.then?await s:s)[0];const r={renderWinners:()=>`\n    <h2>Winners (${i.Z.winnersCount})</h2>\n    <h3>Page (${i.Z.winnersPage})</h3>\n    <table class="table" cellspacing="0" border="0" sellpadding="0">\n      <thead>\n        <th>Number</th>\n        <th>Car</th>\n        <th>Name</th>\n        <th class="table-button table-wins \n          ${"wins"===i.Z.sortBy?i.Z.sortOrder:""}" id="sort-by-wins">Wins</th>\n        <th class="table-button table-time \n          ${"time"===i.Z.sortBy?i.Z.sortOrder:""}" id="sort-by-time">Seconds</th>\n      </thead>\n      <tbody>\n        ${i.Z.winners.map(((e,t)=>`\n          <tr>\n            <td>${t+1+10*(i.Z.winnersPage-1)}</td>\n            <td>${a.Z.renderCarImage(e.car.color)}</td>\n            <td>${e.car.name}</td>\n            <td>${e.wins}</td>\n            <td>${e.time}</td>\n          </tr>\n        `)).join("")}\n      </tbody>\n    </table>\n    `}}))},911:(e,t,n)=>{n.a(e,(async e=>{n.d(t,{Z:()=>r});var a=n(517),i=e([a]);function s(){const e=function(){const e=window.location.hash?window.location.hash.slice(1):"",[t]=e.split("/");return t}();e&&("cars-garage"===e&&a.Z.garageRoute(),"race-winners"===e&&a.Z.winnersRoute())}a=(i.then?await i:i)[0];const r={init(){window.addEventListener("hashchange",s),s()}}}))},549:(e,t,n)=>{n.a(e,(async e=>{n.d(t,{Z:()=>d});var a=n(268);const{items:i,count:s}=await a.Z.getCars(1),{items:r,count:o}=await a.Z.getWinners({page:1,limit:10,sort:"id",order:"ASC"}),d={carsPage:1,cars:i,carsCount:s,winnersPage:1,winners:r,winnersCount:o,animation:{},view:"garage",sortBy:"id",sortOrder:"desc",pageGarageLimit:7,pageWinnersLimit:10,selectedCar:{name:"",color:"",id:0},async updateStoreGarage(){const{items:e,count:t}=await a.Z.getCars(this.carsPage);this.cars=e,this.carsCount=t},async updateStoreWinners(){const{items:e,count:t}=await a.Z.getWinners({page:this.winnersPage,limit:10,sort:this.sortBy,order:this.sortOrder});this.winners=e,this.winnersCount=t}};e()}),1)},701:(e,t,n)=>{n.d(t,{Z:()=>o});const a=["Tesla","Mersedes","BMW","Toyota","Lada","Moskvich","Opel","Porche","Subaru","Nissan"],i=["Model S","CLK","X5","Caldina","Kalina","412","Astra","Cayene","Forester","Cube"];function s(e){const{top:t,left:n,width:a,height:i}=e.getBoundingClientRect();return{x:n+a/2,y:t+i/2}}function r(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}const o={getDistanceBetweenElements(e,t){const n=s(e),a=s(t);return Math.hypot(n.x-a.x,n.y-a.y)},animation(e,t,n){let a=0;const i={id:0};return i.id=window.requestAnimationFrame((function s(r){a||(a=r);const o=r-a,d=Math.round(o*(t/n));e.style.transform=`translateX(${Math.min(d,t)}px)`,d<t&&(i.id=window.requestAnimationFrame(s))})),i},generateRandomCars(e=100){const t=new Array(e);for(let n=0;n<e;n++)t[n]={name:`${a[Math.floor(Math.random()*a.length)]} ${i[Math.floor(Math.random()*a.length)]}`,color:r()};return t}}},755:(e,t,n)=>{n.d(t,{Z:()=>a});const a={async renderBaseTemplate(){const e=document.createElement("div");e.innerHTML='\n    <div class="menu">\n      <a class="button garage-menu-button primary" id="garage-menu" href="#cars-garage">To garage</a>\n      <a class="button winners-menu-button primary" id="winners-menu" href="#race-winners">To winners</a>\n    </div>\n    <div id="garage-view">\n      <div>\n        <form class="form" id="create">\n          <input type="text" class="input" id="create-name" name="name" required="required"></input>\n          <input type="color" class="input" id="create-color" name="color" value="#ffffff"></input>\n          <button class="button" type="submit" id="create-submit">Create</button>\n        </form>\n        <form class="form" id="update">\n          <input type="text" class="input" id="update-name" name="name" disabled required="required"></input>\n          <input type="color" class="input" id="update-color" name="color" value="#ffffff" disabled></input>\n          <button class="button" type="submit" id="update-submit" disabled>Update</button>\n        </form>\n      </div>\n      <div class="race-control">\n        <button class="button race-button primary" id="race">Race</button>\n        <button class="button reset-button primary" id="reset">Reset</button>\n        <button class="button generator-button" id="generate">Generate cars</button>\n      </div>\n      <div id="garage">\n        \n      </div>\n      <div>\n        <p class="message" id="message"></p>\n      </div>\n    </div>\n    <div id="winners-view" style="display: none">\n    \n    </div>\n    <div class="pagination">\n      <button class="button primary prev-button" disabled id="prev">Prev</button>\n      <button class="button primary next-button" disabled id="next">Next</button>\n    </div>\n    ',document.body.appendChild(e)}}}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return s[e](n,n.exports,o),n.exports}e="function"==typeof Symbol?Symbol("webpack then"):"__webpack_then__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n=e=>{e&&(e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},a=e=>!--e.r&&e(),i=(e,t)=>e?e.push(t):a(t),o.a=(s,r,o)=>{var d,c,l,u=o&&[],m=s.exports,g=!0,p=!1,w=(t,n,a)=>{p||(p=!0,n.r+=t.length,t.map(((t,i)=>t[e](n,a))),p=!1)},h=new Promise(((e,t)=>{l=t,c=()=>(e(m),n(u),u=0)}));h[t]=m,h[e]=(e,t)=>{if(g)return a(e);d&&w(d,e,t),i(u,e),h.catch(t)},s.exports=h,r((s=>{if(!s)return c();var r,o;d=(s=>s.map((s=>{if(null!==s&&"object"==typeof s){if(s[e])return s;if(s.then){var r=[];s.then((e=>{o[t]=e,n(r),r=0}));var o={[e]:(e,t)=>(i(r,e),s.catch(t))};return o}}return{[e]:e=>a(e),[t]:s}})))(s);var l=new Promise(((e,n)=>{(r=()=>e(o=d.map((e=>e[t])))).r=0,w(d,r,n)}));return r.r?l:o})).then(c,l),g=!1},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o(303)})();